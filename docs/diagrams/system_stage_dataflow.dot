digraph G {
  graph [
    rankdir=TB,
    splines=ortho,
    nodesep=0.62,
    ranksep=1.00,
    pad=0.22,
    fontname="Helvetica"
  ];

  node [
    shape=box,
    style="rounded,filled",
    fontname="Helvetica",
    fontsize=10,
    margin="0.12,0.08"
  ];

  // Defaults; overridden per-edge category below
  edge [
    fontname="Helvetica",
    fontsize=9,
    color="#444444",
    penwidth=1.0,
    arrowhead="normal"
  ];

  // --- Legend --------------------------------------------------------------
  legend [
    fillcolor="#FFFFFF",
    color="#777777",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Legend</B></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT POINT-SIZE="9">
          <B>Boxes</B><BR/>
          &#9633; Stage (code boundary) &nbsp;&nbsp;|&nbsp;&nbsp; <FONT COLOR="#2B7BBB">&#9633;</FONT> Artifact (on disk) &nbsp;&nbsp;|&nbsp;&nbsp; <FONT COLOR="#777777">&#9633;</FONT> Reference / legacy / input<BR/><BR/>
          <B>Arrows</B><BR/>
          solid black = writes artifacts<BR/>
          blue dashed (open head) = reads / consumes artifacts<BR/>
          gray dashed = optional path / mode<BR/><BR/>
          <B>Path tokens</B> &lt;suite_id&gt; &lt;case_id&gt; &lt;run_id&gt; &lt;tool&gt;<BR/>
          Suite-mode root: <FONT FACE="Courier">runs/suites/&lt;suite_id&gt;/</FONT>
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  // --- Nodes --------------------------------------------------------------

  stage1 [
    fillcolor="#FFFFFF",
    color="#666666",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>1) CLI + command wiring</B></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          sast_cli.py + cli/dispatch.py<BR/>
          cli/commands/* (scan/benchmark/analyze)<BR/>
          cli/commands/suite/* (runbook)
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  stage2 [
    fillcolor="#FFFFFF",
    color="#666666",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>2) Resolver boundary</B> <FONT POINT-SIZE="9">(suite planning)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          pipeline/suites/*<BR/>
          suite_resolver.py (writes suite.json first)<BR/>
          layout.py + bundles.py + manifests.py
        </FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT POINT-SIZE="9">
          <B>Contract:</B> <FONT FACE="Courier">suite.json</FONT> + <FONT FACE="Courier">cases/&lt;case_id&gt;/case.json</FONT>
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  suiteplan [
    fillcolor="#E8F1FF",
    color="#5B8DEF",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Suite plan dir</B></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          suite.json + README.txt + summary.csv<BR/>
          cases/&lt;case_id&gt;/case.json<BR/>
          replay/* (optional) + ../LATEST
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  stage3 [
    fillcolor="#FFFFFF",
    color="#666666",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>3) Orchestration + execution</B></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          pipeline/{pipeline,orchestrator}.py<BR/>
          pipeline/execution/* (plan/run_case/runner/record)<BR/>
          scanners.py (registry) + core.py (build cmds)
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  workspace [
    fillcolor="#F6F6F6",
    color="#777777",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Workspace / repo checkout</B> <FONT POINT-SIZE="9">(input)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT POINT-SIZE="9">
          local worktree at a specific repo + ref
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  stage4 [
    fillcolor="#FFFFFF",
    color="#666666",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>4) Tool runner boundary</B> <FONT POINT-SIZE="9">(scan + normalize)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          tools/scan_&lt;tool&gt;.py (entrypoints)<BR/>
          tools/&lt;tool&gt;/{runner,normalize}.py<BR/>
          tools/io.py + tools/normalize/*
        </FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT POINT-SIZE="9">
          <B>Contract:</B> <FONT FACE="Courier">normalized.json</FONT> (schema v1.1) + <FONT FACE="Courier">metadata.json</FONT>
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  toolrun [
    fillcolor="#E8F1FF",
    color="#5B8DEF",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Tool run dir</B> <FONT POINT-SIZE="9">(Bronze + Silver)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          cases/&lt;case_id&gt;/tool_runs/&lt;tool&gt;/&lt;run_id&gt;/<BR/>
          raw.* + normalized.json (schema v1.1)<BR/>
          metadata.json + logs/ + run.json
        </FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT POINT-SIZE="8">
          Downstream analysis reads <FONT FACE="Courier">normalized.json</FONT>; <FONT FACE="Courier">raw.*</FONT> is for debugging.
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  legacy [
    fillcolor="#F6F6F6",
    color="#777777",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Legacy output layout</B> <FONT POINT-SIZE="9">(no-suite)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          runs/&lt;tool&gt;/&lt;repo_name&gt;/&lt;run_id&gt;/<BR/>
          raw.* + &lt;repo_name&gt;.normalized.json + metadata.json
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  contracts [
    fillcolor="#F6F6F6",
    color="#777777",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Shared contracts + helpers</B></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          sast_benchmark/domain/finding.py<BR/>
          normalized-schema.md + sast_benchmark/io/*<BR/>
          mappings/*.json (OWASP, vendor-OWASP)
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  stage5 [
    fillcolor="#FFFFFF",
    color="#666666",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>5) Per-case analysis</B> <FONT POINT-SIZE="9">(optional)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          pipeline/analysis/* (framework/stages/exports)<BR/>
          experiments/gt_scoring/* (experimental GT scoring)
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  casebins [
    fillcolor="#E8F1FF",
    color="#5B8DEF",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Per-case artifacts</B> <FONT POINT-SIZE="9">(Gold; GT optional)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          cases/&lt;case_id&gt;/analysis/ (tables, checkpoints, packs)<BR/>
          cases/&lt;case_id&gt;/gt/ (gt_catalog, gt_score, gt_gap_queue)
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  stage6 [
    fillcolor="#FFFFFF",
    color="#666666",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>6) Suite-level aggregation + QA calibration</B> <FONT POINT-SIZE="9">(optional)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          pipeline/analysis/suite/* + suite_report/*<BR/>
          cli/.../runbook_steps/qa.py (orchestrates)
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  suiteout [
    fillcolor="#E8F1FF",
    color="#5B8DEF",
    label=<
      <TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0" CELLPADDING="0">
        <TR><TD ALIGN="LEFT"><B>Suite-level outputs</B> <FONT POINT-SIZE="9">(Gold; optional)</FONT></TD></TR>
        <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="9">
          analysis/ (triage_calibration, datasets, reports)<BR/>
          (optional) gt_tolerance_sweep.* + _sweeps/...
        </FONT></TD></TR>
      </TABLE>
    >
  ];

  // --- Edges --------------------------------------------------------------

  // Control flow (between stages)
  stage1 -> stage2 [color="#444444", penwidth=1.0];
  stage2 -> stage3 [color="#444444", penwidth=1.0];
  stage3 -> stage4 [color="#444444", penwidth=1.0];

  // Optional control-flow paths
  stage4 -> stage5 [color="#999999", style="dashed", penwidth=1.0];
  stage5 -> stage6 [color="#999999", style="dashed", penwidth=1.0];

  // Writes (solid black)
  stage2 -> suiteplan [color="#000000", penwidth=1.4];
  stage4 -> toolrun   [color="#000000", penwidth=1.4];
  stage5 -> casebins  [color="#000000", penwidth=1.4];
  stage6 -> suiteout  [color="#000000", penwidth=1.4];

  // Reads (blue dashed, open arrowhead)
  suiteplan -> stage3 [color="#2B7BBB", style="dashed", penwidth=1.2, arrowhead="onormal"];
  workspace -> stage4 [color="#2B7BBB", style="dashed", penwidth=1.2, arrowhead="onormal"];
  toolrun   -> stage5 [color="#2B7BBB", style="dashed", penwidth=1.2, arrowhead="onormal"];
  casebins  -> stage6 [color="#2B7BBB", style="dashed", penwidth=1.2, arrowhead="onormal"];

  // --- Layout -------------------------------------------------------------
  { rank = same; legend; stage1; }
  { rank = same; stage2; suiteplan; }
  { rank = same; stage3; }
  { rank = same; workspace; stage4; toolrun; legacy; contracts; }
  { rank = same; stage5; casebins; }
  { rank = same; stage6; suiteout; }
}
